# コンテンツ一覧仕様（作成中）

## 一覧表示切り替え
ツリー構造と表形式の２パターンの表示に切り替える事ができる。

## コンテンツ追加機能
コンテンツの追加は、一覧でフォルダを指定して（コンテンツを指定した場合はそのコンテンツの親フォルダが対象）、メニューボタンのクリック、または、右クリックにてメニューを表示し、任意のコンテンツを選択して追加する。
コンテンツの追加時には、Configure で設定した routes 設定を参照し、Ajax リクエストを実行する。

## 重複チェック・自動変換

重複した場合には自動的に数字のサフィックスが付加される。  
（例）「新しいフォルダー_2」

### 追加機能の実装
Ajax リクエスト時には、 `$this->request->data` で、以下の配列の形式でデータを受け取れるのでそのデータを利用して保存処理を実装する。

	Array
	(
		[Content] => Array
		(
			[parent_id] => '親のコンテンツID'
			[title] => 'タイトル'
			[plugin] => 'プラグイン名'
			[type] => 'コンテンツタイプ'
			[site_id] => 'サイトID'
			[alias_id] => 'エイリアスID'
			[entity_id] => 'コンテンツ本体のID'
		)
	)

保存完了時には、以下の形式のデータを json_encode を実行し、ブラウザに返す。
コンテンツIDは、Content::id を参照して取得する。
フルURLは、Content::getUrlById() を利用して取得する。

	Array
	(
		[contentId] => '新しく作成した Content のコンテンツID'
		[entityId] => '新しく作成した本体コンテンツのID'
		[fullUrl] => 'ルートから始まるフルURL'
	)

サーバーサイドプログラムの実装例

```php
public function admin_add() {
	$this->autoRender = false;
	if(!$this->request->data) {
		$this->ajaxError(500, '無効な処理です。');
	}
	$this->request->data['MultiPage'] = array('content' => '本文が入ります。本文が入ります。本文が入ります。');
	if ($data = $this->MultiPage->save($this->request->data)) {
		$message = 'マルチページ「' . $this->request->data['Content']['title'] . '」を追加しました。';
		$this->setMessage($message, false, true, false);
		return json_encode(array(
			'contentId' => $this->Content->id,
			'entityId' => $this->MultiPage->id,
			'fullUrl' => $this->Content->getUrlById($this->Content->id, true)
		));
	} else {
		$this->ajaxError(500, '保存中にエラーが発生しました。');
	}
	return false;
}
```

## コンテンツの確認機能
## コンテンツの公開・非公開機能
コンテンツの親フォルダが非公開となっている場合、公開への切り替えはできない。

## コンテンツの管理機能
編集画面以外を提供する場合に利用。ブログの記事一覧等

## 名称変更
タイトルを簡単に変更できる機能。  
新規追加時のみ、タイトルをURLエンコードして name に保存する。  
サイトルートのフォルダの名称変更はできない。

## 編集
編集画面に移動

## コピー
フォルダはコピーできない

## 削除
## フォルダを追加
## エイリアスを追加
## リンクを追加
## 配置移動・並び順変更
### ツリーの整合性保持対策（未実装）
並び替え時に他者がツリー構造の変更を行っている場合不整合がおきてしまい、ツリー構造が壊れてしまう。  
並び替え情報更新前に以下の手順でチェックを行う。
- 並び替え処理完了時に site_configs テーブルの contents_sort_last_modified に現在の時間を保存
- コンテンツ一覧表示時に表示した時間をブラウザ上の変数に保持
- 並び替え実行直前に ブラウザ上の時間と site_configs テーブルの contents_sort_last_modified を比較
- contents_sort_last_modified が新しければ処理を中断しリロードを促す

## アクセス制限設定による操作制限（未実装）
## プラグインのアンインストール（未実装）
## 表形式一覧（未実装）
### 検索機能
### 一括処理
#### 一括公開状態変更
#### 一括削除
