# コンテンツ管理機能基本仕様（作成中）

固定ページだけでなくプラグインも含め「コンテンツ」とし、全てコンテンツをツリー構造で管理する機能。

## ツリー構造仕様
- コンテンツをグルーピングする「フォルダ」を入れ子構造で作成する事ができる。
- フォルダの配下には、コンテンツ及び子フォルダが配置できるが、コンテンツの配下にコンテンツを配置する事はできない。
- コンテンツとなりえるものは次のものとする
  - 固定ページ（単ページコンテンツ）
  - リンク（内部リンク・外部リンク）
  - エイリアス（コンテンツの別名、ショートカットのようなもの）
  - プラグインが提供するコンテンツ（ブログ、メール等）
- サブフォルダを一つのサイトとして登録する事で個別に管理できる。
- コンテンツを削除する際は一旦ゴミ箱に移動する事ができる（論理削除）
- コンテンツを右クリック、または、メニューボタンをクリックする事でコンテキストメニューを表示し次のアクションを行う事ができる。
  - 確認（別タブでフロントページへ移動）
  - 公開
  - 非公開
  - 管理（編集画面以外を提供する場合に利用。ブログの記事一覧等）
  - 名称変更（タイトル）
  - 編集（編集画面に移動）
  - 削除
  - フォルダを追加
  - エイリアスを追加
  - リンクを追加
  - 各コンテンツを追加
- コンテンツをダブルクリックで編集画面に遷移。
- フォルダをダブルクリックでフォルダの開閉を実行。
- ドラッグアンドドロップでツリー上の配置を移動。

## フロントにおけるURLの仕様
URLはフォルダとコンテンツの階層構造により表現される

    （例）
	■ 固定ページ
	company フォルダ内の about ページ
	/company/about

	■ ブログ
	juken フォルダ内の news ブログ
	/juken/news/index

	上記の詳細ページ
	/juken/news/archives/1

	上記の topics カテゴリの記事一覧
	/juken/news/archives/category/topics

# 実装方針
- contents テーブル名を search_indexes 等に変更し、モデル、コントローラー、ビュー全て名称を移行する
  - 現在のcontentsテーブルは、検索インデックス情報を管理しており、検索インデックスとコンテンツの情報は質が違う為、名称リファクタリングを行う。
  - 情報の質が違う理由は、ブログ記事の詳細ページは、検索インデックスで管理される必要があるが、プラグインコンテンツとして登録されないので、コンテンツ管理では管理されるべきでない為。
- contents テーブル、またそれにまつわるMVCを別途作成し、下記の情報を管理する

		* site_id		:サイトID
		* name			:コンテンツ名（URLで利用）
		* plugin			:プラグイン名（コアの場合は Core）
		* type			:コンテンツタイプ
		* url			:ルーティング設定用のフロントURL（自動生成）
		* parent_id		:親のコンテンツID
		* lft			:木構造の左位置
		* rhgt			:木構造の右位置
		* title			:タイトル
		* description		:説明文
		* status			:公開状態
		* publish_begin		:公開開始日
		* publish_end		:公開終了日
		* eyecatch		:一覧用のアイキャッチ
		* author_id		:作成者
		* created_date		:作成日
		* modified_date		:編集日
		* exclude_search		:検索除外設定
		* entity_id		:コンテンツ本体特定用ID
		* alias_id		:エイリアス元のコンテンツID
		* site_root		:サイトのルートフォルダかどうか
		* deleted_date		:削除日
		* deleted		:削除フラグ
		* layout_template	:レイアウトテンプレート
		* main_site_content	:メインサイトのコンテンツID
		* created		:作成日（システム管理用）
		* modified		:編集日（システム管理用）

* コンテンツとして管理する機能は、コントローラーにおいて、BcContentsComponent、モデルにおいて、BcContentsBehaviorを設定する事で、Content モデルと容易に連携する事ができるようになる。
* 固定ページや、プラグインのコンテンツは、内容についてそれぞれのテーブルにて管理されるが、コンテンツとしての共通部分について定義された contents テーブルと連携して管理する。

  ※ 例えば固定ページを追加する場合、pagesテーブルに登録すると同時にcontentsテーブルにもデータを紐付けた上で登録する。
* ルーティングについては、contents テーブルに格納されたURLをキーに動的ルーティング設定を行う






