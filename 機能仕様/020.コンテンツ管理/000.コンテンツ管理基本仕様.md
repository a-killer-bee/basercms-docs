# コンテンツ管理機能基本仕様

固定ページだけでなくプラグインも含め「コンテンツ」とし、全てコンテンツをツリー構造で管理する機能。

## ツリー構造仕様
- コンテンツをグルーピングする「フォルダ」を入れ子構造で作成する事ができる。
- フォルダの配下には、コンテンツ及び子フォルダが配置できるが、コンテンツの配下にコンテンツを配置する事はできない。
- コンテンツとなりえるものは次のものとする
  - 固定ページ（単ページコンテンツ）
  - リンク（内部リンク・外部リンク）
  - エイリアス（コンテンツの別名、ショートカットのようなもの）
  - プラグインが提供するコンテンツ（ブログ、メール等）
- サブフォルダを一つのサイトとして登録する事で個別に管理できる。
- コンテンツを削除する際は一旦ゴミ箱に移動する事ができる（論理削除）
- コンテンツを右クリック、または、メニューボタンをクリックする事でコンテキストメニューを表示し次のアクションを行う事ができる。
  - 確認（別タブでフロントページへ移動）
  - 公開（非公開時）
  - 非公開（公開時）
  - 管理（編集画面以外を提供する場合に利用。ブログの記事一覧等）
  - 名称変更（コンテンツタイトル）
  - 編集（編集画面に移動）
  - 削除（論理削除）
  - フォルダを追加
  - エイリアスを追加
  - リンクを追加
  - 各コンテンツを追加
- コンテンツをダブルクリックで編集画面に遷移。
- フォルダをダブルクリックでフォルダの開閉を実行。
- ドラッグアンドドロップでツリー上の配置を移動。

## フロントにおけるURLの仕様
URLはフォルダとコンテンツの階層構造により表現される

    （例）
	■ 固定ページ
	company フォルダ内の about ページ
	/company/about

	■ ブログ
	juken フォルダ内の news ブログ
	/juken/news/index

	上記の詳細ページ
	/juken/news/archives/1

	上記の topics カテゴリの記事一覧
	/juken/news/archives/category/topics

# 実装方針
- `contents` テーブル名を `search_indexes` に変更し、モデル、コントローラー、ビュー全て名称を移行する
  - 現在の `contents` テーブルは、検索インデックス情報を管理しており、検索インデックスとコンテンツの情報は質が違う為、名称リファクタリングを行う。
  - 情報の質が違う理由は、ブログ記事の詳細ページは、検索インデックスで管理される必要があるが、プラグインコンテンツとして登録されないので、コンテンツ管理では管理されるべきでない為。
- `contents` テーブル、またそれに関連すうるMVCを別途作成し、下記の情報を管理する

| フィールド名 | 説明 |
|---------:|:---------|
| name | コンテンツ識別名（URL で利用する） |
| plugin | プラグイン名（CamelCase で指定、コアの場合は Core） |
| type | コンテンツのタイプ（CamelCase で指定） |
| entity_id | コンテンツ本体を特定する為の識別番号 |
| url | フロントURL（自動生成、ルーティング設定に利用） |
| site_id | サブサイトを特定するID（サブサイトでない場合は0） |
| alias_id | エイリアス元のコンテンツID（自動生成、エイリアスでない場合は null） |
| main_site_content_id | メインサイトのコンテンツID（自動生成、サブサイトで内場合 null） |
| parent_id | 親のコンテンツID |
| lft | 木構造の左位置（自動生成） |
| rhgt | 木構造の右位置（自動生成） |
| level | 階層数（自動生成） |
| title	| タイトル（タイトルタグに利用する） |
| description | 説明文（meta タグに利用する） |
| eyecatch | 一覧用のアイキャッチ画像 |
| author_id | 作成者 |
| layout_template | レイアウトテンプレート |
| status | 公開状態（自動生成、親コンテンツを継承した結果を設定） |
| publish_begin | 公開開始日（自動生成、親コンテンツを継承した結果を設定） |
| publish_end | 公開終了日（自動生成、親コンテンツを継承した結果を設定） |
| self_status | コンテンツ自体の公開状態 |
| self_publish_begin | コンテンツ自体の公開開始日 |
| self_publish_end | コンテンツ自体の公開終了日 |
| exclude_search | 検索除外設定（検索結果から除外する場合に true を設定する） |
| created_date | 作成日 |
| modified_date | 編集日 |
| site_root | サイトルート設定（自動生成、サイトのルートフォルダの際に trueが設定される） |
| deleted_date | 削除日（自動生成） |
| deleted | 削除フラグ（自動生成） |
| exclude_menu | メニュー場外設定（メニューから除外する場合に true を設定する） |
| blank_link | ブランクリンク設定（メニューのリンクを別窓で開く場合に true を設定する） |
| created | 作成日（自動生成、システム管理用） |
| modified | 編集日（自動生成、システム管理用） |

- コンテンツとして管理する機能は、コントローラーにおいて、`BcContentsComponent` 、モデルにおいて、`BcContentsBehavior` を設定する事で、Content モデルと容易に連携する事ができるようになる。（必須ではない）
- 固定ページや、プラグインのコンテンツは、内容についてそれぞれのテーブルにて管理されるが、コンテンツとしての共通部分について定義された `contents` テーブルと連携して管理する。

  ※例えば固定ページを追加する場合、 `pages` テーブルに登録すると同時に `contents` テーブルにもデータを紐付けた上で登録する。
- ルーティングについては、`contents` テーブルに格納されたURLをキーに動的ルーティング設定を行う






