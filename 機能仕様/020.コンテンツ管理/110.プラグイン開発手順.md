# プラグイン開発手順（作成中）

## 用語の定義

- ツリーレコード：Content モデルが管理するツリー構造上での配置を管理するデータ
- コンテンツ実体：ツリーレコードと連携するコンテンツの本体

## コンテンツパターン
プラグインが提供するコンテンツについて、ツリー構造上に、複数配置する場合は、
複数のコンテンツがツリーレコードと連携するように開発する。これをマルチコンテンツと定義する。
そうでないコンテンツをシングルコンテンツと定義する。

### マルチコンテンツ
複数のコンテンツをツリーレコードと連携する（＝複数登録できる）
- マルチコンテンツの実装パターン
  - 単ページのコンテンツのみを提供（例：baserCMSの従来の固定ページ）
  - コンテンツと復数記事を提供（例：baserCMSの従来の復数ブログ）
- プラグイン側のレコードを特定するID を、entity_id として、contents テーブルに提供し、結合する
- 別途コンテンツ管理用のテーブルの準備が必要

各タイプについて、マルチコンテンツかどうかを判定するには、次のプロパティの値を確認する
 
```php
BcContentsHelper::settings[type]['multiple']
 
（例）
if($this->BcContents->settings['MailContent']['multiple']) {
	// マルチコンテンツ
}
```

### シングルコンテンツ
複数のコンテンツをツリーレコードと連携しない（＝複数登録できない）  
この場合、２つ目以降、コンテンツ実体の登録できず、エイリアスとしての登録となる。
- シングルコンテンツの実装パターン
  - 単ページのコンテンツのみを提供（例：単ページ）
  - コンテンツの設定と複数記事のみを提供（例：設定付き単ブログ）
  - 複数記事のみを提供（例：単ブログ）
- コンテンツ実体を特定するIDを contents テーブル側では持たない
- コンテンツ実体管理用のテーブルは必須ではない

各タイプについて、既に配置済のコンテンツが存在するかどうかを判定するには、次のプロパティの値を確認する

```php
BcContentsHelper::settings[type]['exists']

（例）
if($this->BcContents->settings['SinglePage']['exists']) {
	// コンテンツが既に存在する
}
```

### 実装パターン別機能利用可否
（例）サンプルプラグインによる機能利用可否  

| タイプ | 管理 | 追加 | 編集 | 削除 | 確認 | コピー |
|---------:|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
| シングルページ | × | １つのみ | ○ | ○ | ○ | 提供選択可 |
| シングルブログ | ○ | １つのみ | ○ | ○（記事の削除も必要） | ○ | 提供選択可 |
| シングルページ | × | ○ | ○ | ○ | ○ | 提供選択可 |
| シングルブログ | ○ | ○ | ○ | ○（記事の削除も必要） | ○ | 提供選択可 |

## コンテンツ登録設定

プラグインが提供するコンテンツを、コンテンツ管理上で利用できるようにする為には、
`Config/setting.php` にコンテンツ登録の設定が必要。

```php
//（例）MultiBlog というプラグインの場合
$config['BcContents']['items']['MultiBlog'] = [
	'MultiBlogContent'	=> [
		'multiple'	=> true,	// 複数コンテンツに対応するかどうか
		'preview'	=> true,	// 編集画面でリアルタイムなプレビュー機能に対応するかどうか
		'title' => 'マルチブログ',	// プラグインタイトル
		'icon'	=> 'admin/icon_multi_blog.png',	// アイコンパス
		'routes' => [	// 各動作設定のURL設定（view 以外、自動的にコントローラー名の前方に admin_ を付与する。
			'manage' => [	// 管理（任意：ブログの記事一覧など）
				'plugin'	=> 'multi_blog',
				'controller'=> 'multi_blog_posts',
				'action'	=> 'index'
			],
			'add'	=> [	// 新規登録（必須：Ajaxで呼び出される）
				'plugin'	=> 'multi_blog',
				'controller'=> 'multi_blog_contents',
				'action'	=> 'add'
			],
			'edit'	=> [	// 編集（必須：編集画面の準備が必要）
				'plugin'	=> 'multi_blog',
				'controller'=> 'multi_blog_contents',
				'action'	=> 'edit'
			],
			'delete' => [	// 削除（必須：requestAction で呼び出される）
				'plugin'	=> 'multi_blog',
				'controller'=> 'multi_blog_contents',
				'action'	=> 'delete'
			],
			'copy'	=> [	// コピー（任意：Ajaxで呼び出される）
				'plugin'	=> 'multi_blog',
				'controller'=> 'multi_blog_contents',
				'action'	=> 'copy'
			],
			'view' => [		// フロントページでの表示（必須）
				'plugin'	=> 'multi_blog',
				'controller'=> 'multi_blog',
				'action'	=> 'index'
			]
		]
	]
];
```

## 管理機能の実装
## 追加機能の実装
## 編集機能の実装
## 削除機能の実装
## コピー機能の実装
## フロント表示機能の実装
## 編集リンク実装
## 公開リンク実装
## サイト内検索登録実装

