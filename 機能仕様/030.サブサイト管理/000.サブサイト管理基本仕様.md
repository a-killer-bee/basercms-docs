# サブサイト管理機能基本仕様

## メインサイト設定
- サイト基本設定で設定してる情報をサイト構造上、最上位サイトとし、特別な扱いとする。
- メインサイトを選択し子サイトとして登録する事ができる。子サイトとして登録した場合、サイト内の同階層のコンテンツを連携する事ができる。デフォルトは最上位サイトの「パソコン」となり、それと連携する。
- メインサイトを設定する事でサイト内の同階層のコンテンツを連携する事ができる。
- サブサイトをメインサイトとして登録する事ができる。


	（例）英語サイト[en] をメインサイトとして、スマートフォンサイト[en/sp] を子サイトとして登録する場合  
	/en/about/index
	/en/sp/about/index
	
## テンプレートのサブフォルダ化
各テンプレートを作成する際、通常配置するフォルダ配下に、サイトの識別名称と同じ名称のフォルダを作成し、その中にテンプレートを配置するとフロントページを表示する際、そちらのテンプレートを優先して利用する。

	（例）識別名称が smartphone で、レイアウトテンプレートに default を利用する場合
	Layouts/default.php
	Layouts/smartphone/default.php ←こちらが優先となる
	
## テーマ設定	
- サイトごとにテーマを切り替える事ができる。最上位サイトのテーマは、テーマ管理で設定したテーマとする。
- 初期データは、最上位サイトに設定されたテーマの初期データを利用する。

## フロントページ
- フロントページでは、識別名称、または、エイリアスをサブフォルダとしたURLでコンテンツを参照する事ができる。
- サイトごとにタイトルタグを切り替える事ができる。
- メインサイトとサブサイト間のリンクを設置できる

## メインサイト自動連携
エイリアスを利用してメインサイトと自動連携する事ができる。  

- メインサイトにコンテンツを作成する度にサブサイトに自動的にエイリアスを作成する。
- メインサイトに作成したものがエイリアスの場合は無視する。
- 既にサブサイトの同一階層にコンテンツが存在する場合は無視する。
- 既に連携状態でメインサイトのコンテンツのURLを変更しようとした場合、子サイトに同名のコンテンツが存在すれば、警告を表示し処理を中断する。
- 自動連携を設定している場合、サブサイトのエイリアスはURL以外の編集を行う事できない。
- サブサイトのエイリアスのURLを変更した場合、連携状態は解除となる。
- メインサイトのコンテンツを削除した場合、子サイトのエイリアスはゴミ箱に入れず完全に削除する。
- メインサイトのコンテンツを削除した場合、子サイトの関連コンテンツはエイリアスでない場合、連携状態は解除となる。
- 既にサブサイトに存在するコンテンツと同階層のコンテンツをメインサイトに作成した場合、自動的に連携状態となる。

| タイプ | メインURL変更 | メイン編集 | メイン削除 | サブURL変更 | サブ編集 | サブ削除 |
|---------:|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
| エイリアス | 連携 | 連携 | 完全削除 | 連携解除 | 不可 | 可 |
| コンテンツ | 連携 | 連携なし | 連携なし | 連携解除 | 可 | 可 |
| フォルダ | 連携 | 連携 | 連携解除 | 連携解除 | 不可 | 可 |

## デバイス用識別名称

後方互換の為、mobile と smartphone については、特別な識別名称として取り扱う。

## デバイス用ヘルパー連携
  
フロントページ呼び出し時に、各関連ヘルパーが自動的に初期化される。  

- mobile：BcMobileHelper
- smartphone：BcSmartphoneHelper

自動初期化するヘルパーは、 `/lib/Baser/Config/setting.php` の、 `BcAgent` にて定義されており、 `/app/Config/setting.php` にて設定を上書きする事ができる。